name: sportly
app: node@18
options:
  git:
    url: https://github.com/soccerteam-matchapp/backend.git
    branch: dev
  env:
    - name: NODE_ENV
      value: production
  install: |
    set -e
    set -x
    # pnpm í™•ë³´
    if command -v corepack >/dev/null 2>&1; then
      corepack enable
      corepack prepare pnpm@9 --activate || true
    else
      npm i -g pnpm
    fi

    pnpm -v
    # ì˜ì¡´ì„± ì„¤ì¹˜ (lockfile ë¶ˆì¼ì¹˜ë¡œ ë§‰íˆì§€ ì•Šê²Œ)
    pnpm install --no-frozen-lockfile

    # ë¹Œë“œ ì‹¤í–‰
    pnpm run -r build || pnpm run build

    # ğŸ‘‰ ë¹Œë“œ ì‚°ì¶œë¬¼ ì¡´ì¬ í™•ì¸ (ë””ë²„ê¹…ìš© ë¡œê·¸)
    echo "---- ls dist ----"
    ls -la dist || true
    echo "---- tree dist (ìµœëŒ€ 2depth) ----"
    find dist -maxdepth 2 -type f -print || true
  ports: 3000
  start: pnpm start
