openapi: 3.0.3
info:
  title: Sportly API
  version: 1.0.0
  description: Sportly 백엔드 API (status/message/data 응답 포맷)
servers:
  - url: https://{host}
    variables:
      host:
        default: localhost:3000
tags:
  - name: Auth
  - name: Team
  - name: Match
  - name: Phone
  - name: Notification

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            bad:
              value: { status: 400, message: "요청 형식이 올바르지 않습니다.", data: null, error: "bad_request" }
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            unauthorized:
              value: { status: 401, message: "인증이 필요합니다.", data: null, error: "unauthorized" }
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            forbidden:
              value: { status: 403, message: "권한이 없습니다.", data: null, error: "forbidden" }
    Conflict:
      description: Conflict
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            conflict:
              value: { status: 409, message: "리소스 충돌", data: null, error: "conflict" }
    NotFound:
      description: Not Found
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            notFound:
              value: { status: 404, message: "리소스를 찾을 수 없습니다.", data: null, error: "not_found" }
    ServerError:
      description: Server Error
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BaseResponse" }
          examples:
            error:
              value: { status: 500, message: "서버 오류", data: null, error: "server_error" }

  schemas:
    BaseResponse:
      type: object
      properties:
        status: { type: integer, example: 200 }
        message: { type: string, example: "OK" }
        data: {}
        error: { type: string, nullable: true, example: null }
      required: [status, message, data]

    RegisterRequest:
      type: object
      properties:
        id: { type: string, example: "soccer123" }
        name: { type: string, example: "정혜원" }
        password: { type: string, minLength: 8, example: "secret12" }
        username:
          type: string
          description: username를 보내면 내부적으로 name으로 매핑 처리
      required: [id, password]
    LoginRequest:
      type: object
      properties:
        id: { type: string }
        password: { type: string }
      required: [id, password]
    RefreshRequest:
      type: object
      properties:
        refreshToken: { type: string }
      required: [refreshToken]

    UserPublic:
      type: object
      properties:
        id: { type: string, description: "사용자 _id(ObjectId)" }
        name: { type: string }
        role: { type: string, enum: ["member", "leader"] }
      required: [id, name, role]

    LoginData:
      type: object
      properties:
        accessToken: { type: string }
        refreshToken: { type: string }
        user: { $ref: "#/components/schemas/UserPublic" }
      required: [accessToken, refreshToken, user]

    TokensData:
      type: object
      properties:
        accessToken: { type: string }
        refreshToken: { type: string }
      required: [accessToken, refreshToken]

    Team:
      type: object
      properties:
        id: { type: string, description: "팀 _id" }
        teamName: { type: string }
        inviteCode: { type: string, description: "6자리" }
        leader: { type: string, description: "팀장 _id" }
        memberNum: { type: integer }
        canMatch: { type: boolean, description: "멤버 9명 이상이면 true" }
      required: [id, teamName, inviteCode, leader, memberNum, canMatch]

    TeamJoinDecision:
      type: object
      properties:
        userId:
          type: string
          description: "처리할 사용자 _id"
        action:
          type: string
          enum: [accept, reject]
          description: "수락(accept) 또는 거절(reject)"
      required: [userId, action]

    PhoneRequest:
      type: object
      properties:
        phone:
          type: string
          description: "E.164 (예: +821012345678)"
          example: "+821012345678"
      required: [phone]
    PhoneVerifyRequest:
      type: object
      properties:
        phone: { type: string, example: "+821012345678" }
        code: { type: string, example: "123456" }
      required: [phone, code]
    PhoneVerifyData:
      type: object
      properties:
        verified: { type: boolean, example: true }
        expiresAt: { type: string, format: date-time, nullable: true }

    Match:
      type: object
      properties:
        id: { type: string }
        hostTeamId: { type: string }
        guestTeamId: { type: string, nullable: true }
        date: { type: string, format: date-time, description: "경기 일시(ISO8601)" }
        place: { type: string }
        skillLevel: { type: string, example: "intermediate" }
        exProCount: { type: integer, example: 1, description: "선출 인원수" }
        fieldCost: { type: integer, example: 120000, description: "구장비(원)" }
        guestCostShare: { type: integer, example: 60000, description: "게스트 팀 부담비용(원)" }
        gameFormat: { type: string, example: "11v11 · 45min x2" }
        isMatched: { type: boolean }
        createdAt: { type: string, format: date-time }
      required: [id, hostTeamId, date, place, isMatched]

    MatchCreateRequest:
      type: object
      properties:
        date: { type: string, format: date-time }
        place: { type: string }
        skillLevel: { type: string }
        exProCount: { type: integer }
        fieldCost: { type: integer }
        guestCostShare: { type: integer }
        gameFormat: { type: string }
      required: [date, place]

    MatchApplyRequest:
      type: object
      properties:
        guestTeamId: { type: string, description: "신청하는 게스트 팀 _id" }
      required: [guestTeamId]

    MatchDecideRequest:
      type: object
      properties:
        guestTeamId: { type: string }
        accept: { type: boolean }
      required: [guestTeamId, accept]

    MatchCreateRequestV2:
      type: object
      properties:
        teamId: { type: string, description: "호스트 팀 _id" }
        date: { type: string, format: date-time }
        location: { type: string }
        players: { type: integer, description: "필요한 인원수", minimum: 1 }
        skill: { type: string, enum: [beginner, intermediate, advanced], description: "실력 수준" }
        fieldCost: { type: integer, description: "구장비(원)", minimum: 0 }
        proCount: { type: integer, description: "선출 인원수", minimum: 0, default: 0 }
      required: [teamId, date, location, players, skill, fieldCost]

    MatchApplyRequestV2:
      type: object
      properties:
        teamId: { type: string, description: "신청하는 게스트 팀 _id" }
        matchId: { type: string, description: "매칭 _id" }
        players: { type: integer, description: "참가 인원수" }
      required: [teamId, matchId, players]

    MatchAcceptRequest:
      type: object
      properties:
        matchId: { type: string }
        teamId: { type: string, description: "수락할 게스트 팀 _id" }
      required: [matchId, teamId]

    TeamRatingRequest:
      type: object
      properties:
        score: { type: number, minimum: 1, maximum: 5, description: "평점 (1~5)" }
        comment: { type: string, maxLength: 500, description: "댓글 (선택)", nullable: true }
      required: [score]

    TeamRatingSummary:
      type: object
      properties:
        averageScore: { type: number, description: "평균 평점" }
        totalCount: { type: integer, description: "평점 개수" }
        scoreDistribution: { type: object, description: "점수별 분포" }

    TeamRatingItem:
      type: object
      properties:
        id: { type: string }
        rater: { type: object, properties: { id: { type: string }, name: { type: string } } }
        score: { type: number }
        comment: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      required: [id, score, createdAt, updatedAt]

    TeamRatingListResponse:
      type: object
      properties:
        data: { type: array, items: { $ref: "#/components/schemas/TeamRatingItem" } }
        nextCursor: { type: string, nullable: true, description: "다음 페이지 커서" }
      required: [data]

    NotificationItem:
      type: object
      properties:
        id: { type: string }
        type: { type: string, enum: ["team_join_request", "match_apply", "match_accepted"] }
        title: { type: string }
        message: { type: string }
        read: { type: boolean }
        createdAt: { type: string, format: date-time }
        relatedTeam:
          type: object
          nullable: true
          properties:
            id: { type: string }
            teamName: { type: string }
        relatedMatch:
          type: object
          nullable: true
          properties:
            id: { type: string }
            date: { type: string }
            location: { type: string }
        relatedUser:
          type: object
          nullable: true
          properties:
            id: { type: string }
            name: { type: string }
      required: [id, type, title, message, read, createdAt]

    NotificationCount:
      type: object
      properties:
        count: { type: integer, example: 3 }
      required: [count]