/auth/register:
  post:
    tags: [Auth]
    summary: 회원가입
    description: >
      회원을 생성합니다. `username`을 보내도 내부에서 `name`으로 매핑되어 처리됩니다.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "./openapi.yaml#/components/schemas/RegisterRequest"
          examples:
            default:
              value: { id: "soccer123", name: "정혜원", password: "secret12" }
            allowUsernameAlias:
              value: { id: "soccer123", username: "정혜원", password: "secret12" }
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      nullable: true
                      example: null
            examples:
              created:
                value: { status: 201, message: "회원가입 성공", data: null }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "409": { $ref: "./openapi.yaml#/components/responses/Conflict" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

# 로그인
/auth/login:
  post:
    tags: [Auth]
    summary: 로그인
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "./openapi.yaml#/components/schemas/LoginRequest"
          examples:
            default:
              value: { id: "soccer123", password: "secret12" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      $ref: "./openapi.yaml#/components/schemas/LoginData"
            examples:
              ok:
                value:
                  status: 200
                  message: "로그인 성공"
                  data:
                    accessToken: "eyJhbGciOi..."
                    refreshToken: "eyJhbGciOi..."
                    user:
                      id: "66c7e2d2f3a4f2bb1e8e1b11"
                      name: "정혜원"
                      role: "member"
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/auth/refresh:
  post:
    tags: [Auth]
    summary: 토큰 재발급
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "./openapi.yaml#/components/schemas/RefreshRequest"
          examples:
            default:
              value: { refreshToken: "eyJhbGciOi..." }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      $ref: "./openapi.yaml#/components/schemas/TokensData"
            examples:
              ok:
                value:
                  status: 200
                  message: "토큰 재발급 성공"
                  data:
                    accessToken: "new-access-token"
                    refreshToken: "new-refresh-token"
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

# =======================
# Teams
# =======================

/teams:
  post:
    tags: [Team]
    summary: 팀 만들기(초대코드 발급)
    security: [{ BearerAuth: [] }]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              teamName:
                type: string
            required: [teamName]
          examples:
            default:
              value: { teamName: "FC Tools" }
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        id: { type: string, description: "팀 _id" }
                        teamName: { type: string }
                        inviteCode: { type: string, description: "6자리 초대코드" }
                        leader: { type: string, description: "팀장 _id" }
                        memberNum: { type: integer }
                        canMatch: { type: boolean, description: "멤버 9명 이상이면 true" }
                      required: [id, teamName, inviteCode, leader, memberNum, canMatch]
            examples:
              created:
                value:
                  status: 201
                  message: "팀 생성 성공"
                  data:
                    id: "66cc7a7f0c2e3a1234567890"
                    teamName: "FC Tools"
                    inviteCode: "123456"
                    leader: "66c7e2d2f3a4f2bb1e8e1b11"
                    memberNum: 1
                    canMatch: false
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "409": { $ref: "./openapi.yaml#/components/responses/Conflict" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/teams/invite/{code}:
  get:
    tags: [Team]
    summary: 초대코드로 팀 조회
    description: 초대코드로 팀 기본 정보를 조회합니다.
    security: [{ BearerAuth: [] }]
    parameters:
      - in: path
        name: code
        required: true
        schema: { type: string }
        description: 발급된 6자리 초대코드
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        id: { type: string }
                        teamName: { type: string }
                        inviteCode: { type: string }
                        memberNum: { type: integer }
                        canMatch: { type: boolean }
                      required: [id, teamName, inviteCode, memberNum, canMatch]
            examples:
              ok:
                value:
                  status: 200
                  message: "팀 조회 성공"
                  data:
                    id: "66cc7a7f0c2e3a1234567890"
                    teamName: "FC Tools"
                    inviteCode: "123456"
                    memberNum: 1
                    canMatch: false
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "404": 
        description: Not Found
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              notFound:
                value: { status: 404, message: "해당 초대코드의 팀을 찾을 수 없습니다.", data: null, error: "not_found" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/teams/join:
  post:
    tags: [Team]
    summary: 초대코드로 가입 요청
    security: [{ BearerAuth: [] }]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              inviteCode:
                type: string
            required: [inviteCode]
          examples:
            default:
              value: { inviteCode: "123456" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        teamId: { type: string }
                        pendingCount: { type: integer }
                      required: [teamId, pendingCount]
            examples:
              ok:
                value:
                  status: 200
                  message: "가입 요청 접수"
                  data: { teamId: "66cc7a7f0c2e3a1234567890", pendingCount: 1 }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "404":
        description: Not Found
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              notFound:
                value: { status: 404, message: "해당 초대코드의 팀을 찾을 수 없습니다.", data: null, error: "not_found" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/teams/{teamId}/requests:
  get:
    tags: [Team]
    summary: 가입 대기 목록(팀장 전용)
    security: [{ BearerAuth: [] }]
    parameters:
      - in: path
        name: teamId
        required: true
        schema: { type: string, description: "팀 _id(ObjectId)" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        type: object
                        properties:
                          _id: { type: string }
                          name: { type: string }
                          id: { type: string, description: "로그인 아이디(username)" }
                        required: [_id, name, id]
            examples:
              ok:
                value:
                  status: 200
                  message: "가입 대기 목록"
                  data:
                    - { _id: "66c7e2d2f3a4f2bb1e8e1b11", name: "김철수", id: "cs123" }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              forbidden:
                value: { status: 403, message: "팀장만 확인할 수 있습니다.", data: null, error: "forbidden" }
      "404":
        description: Not Found
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              notFound:
                value: { status: 404, message: "팀을 찾을 수 없습니다.", data: null, error: "not_found" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/teams/{teamId}/requests/decide:
  post:
    tags: [Team]
    summary: 가입 요청 일괄 수락/거절(팀장 전용)
    security: [{ BearerAuth: [] }]
    parameters:
      - in: path
        name: teamId
        required: true
        schema: { type: string, description: "팀 _id(ObjectId)" }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              accept:
                type: array
                items: { type: string, description: "수락할 사용자 _id" }
              reject:
                type: array
                items: { type: string, description: "거절할 사용자 _id" }
            required: [accept, reject]
          examples:
            acceptSome:
              value:
                accept: ["66c7e2d2f3a4f2bb1e8e1b11"]
                reject: []
            rejectSome:
              value:
                accept: []
                reject: ["66c7e2d2f3a4f2bb1e8e1b22"]
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        teamId: { type: string }
                        memberNum: { type: integer }
                        canMatch: { type: boolean }
                        accepted: { type: integer }
                        rejected: { type: integer }
                        remainingPending: { type: integer }
                      required: [teamId, memberNum, canMatch, accepted, rejected, remainingPending]
            examples:
              ok:
                value:
                  status: 200
                  message: "처리 완료"
                  data:
                    teamId: "66cc7a7f0c2e3a1234567890"
                    memberNum: 9
                    canMatch: true
                    accepted: 1
                    rejected: 0
                    remainingPending: 2
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              forbidden:
                value: { status: 403, message: "팀장만 처리할 수 있습니다.", data: null, error: "forbidden" }
      "404":
        description: Not Found
        content:
          application/json:
            schema:
              $ref: "./openapi.yaml#/components/schemas/BaseResponse"
            examples:
              notFound:
                value: { status: 404, message: "팀을 찾을 수 없습니다.", data: null, error: "not_found" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/matches:
  get:
    tags: [Match]
    summary: 매칭 목록 조회(필터 가능)
    description: 날짜/장소/매칭여부 등으로 필터링하여 매칭 목록을 조회합니다.
    parameters:
      - in: query
        name: dateFrom
        schema: { type: string, format: date-time }
        description: 조회 시작 일시(포함)
      - in: query
        name: dateTo
        schema: { type: string, format: date-time }
        description: 조회 종료 일시(미포함)
      - in: query
        name: place
        schema: { type: string }
      - in: query
        name: isMatched
        schema: { type: boolean }
      - in: query
        name: skillLevel
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: array
                      items: { $ref: "./openapi.yaml#/components/schemas/Match" }
            examples:
              ok:
                value:
                  status: 200
                  message: "목록 조회 성공"
                  data:
                    - { id: "66d0...", hostTeamId: "66cc...", date: "2025-09-20T10:00:00+09:00", place: "강남구 A구장", isMatched: false }

  post:
    tags: [Match]
    summary: 매칭 생성(호스트 팀장 전용)
    security: [{ BearerAuth: [] }]
    description: 호스트 팀의 **팀장**만 생성할 수 있으며, 팀원 11명 이상 조건을 만족해야 합니다.
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "./openapi.yaml#/components/schemas/MatchCreateRequest" }
          examples:
            default:
              value:
                date: "2025-09-20T10:00:00+09:00"
                place: "강남구 A구장"
                skillLevel: "intermediate"
                exProCount: 1
                fieldCost: 120000
                guestCostShare: 60000
                gameFormat: "11v11 · 45min x2"
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data: { $ref: "./openapi.yaml#/components/schemas/Match" }
            examples:
              created:
                value:
                  status: 201
                  message: "매칭 생성 성공"
                  data:
                    id: "66d0..."
                    hostTeamId: "66cc..."
                    date: "2025-09-20T10:00:00+09:00"
                    place: "강남구 A구장"
                    isMatched: false
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "./openapi.yaml#/components/responses/Forbidden" }
      "409": { $ref: "./openapi.yaml#/components/responses/Conflict" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/matches/{matchId}:
  get:
    tags: [Match]
    summary: 매칭 상세 조회
    parameters:
      - in: path
        name: matchId
        required: true
        schema: { type: string }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data: { $ref: "./openapi.yaml#/components/schemas/Match" }
            examples:
              ok:
                value:
                  status: 200
                  message: "상세 조회 성공"
                  data:
                    id: "66d0..."
                    hostTeamId: "66cc..."
                    place: "강남구 A구장"
                    date: "2025-09-20T10:00:00+09:00"
                    isMatched: false
      "404": { $ref: "./openapi.yaml#/components/responses/NotFound" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/matches/{matchId}/apply:
  post:
    tags: [Match]
    summary: 매칭 신청(게스트 팀장 전용)
    security: [{ BearerAuth: [] }]
    description: 게스트 팀 **팀장**만 신청 가능하며, 팀원 11명 이상 조건을 만족해야 합니다.
    parameters:
      - in: path
        name: matchId
        required: true
        schema: { type: string }
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "./openapi.yaml#/components/schemas/MatchApplyRequest" }
          examples:
            default:
              value: { guestTeamId: "66cc7a7f0c2e3a1234567890" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        matchId: { type: string }
                        guestTeamId: { type: string }
                        status: { type: string, example: "pending" }
                      required: [matchId, guestTeamId, status]
            examples:
              ok:
                value:
                  status: 200
                  message: "매칭 신청 접수"
                  data: { matchId: "66d0...", guestTeamId: "66cc...", status: "pending" }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "./openapi.yaml#/components/responses/Forbidden" }
      "404": { $ref: "./openapi.yaml#/components/responses/NotFound" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/matches/{matchId}/decide:
  post:
    tags: [Match]
    summary: 매칭 신청 수락/거절(호스트 팀장 전용)
    security: [{ BearerAuth: [] }]
    parameters:
      - in: path
        name: matchId
        required: true
        schema: { type: string }
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "./openapi.yaml#/components/schemas/MatchDecideRequest" }
          examples:
            accept:
              value: { guestTeamId: "66cc...", accept: true }
            reject:
              value: { guestTeamId: "66cc...", accept: false }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        matchId: { type: string }
                        isMatched: { type: boolean }
                        decided: { type: string, enum: ["accepted", "rejected"] }
                      required: [matchId, isMatched, decided]
            examples:
              accepted:
                value:
                  status: 200
                  message: "매칭 수락"
                  data: { matchId: "66d0...", isMatched: true, decided: "accepted" }
              rejected:
                value:
                  status: 200
                  message: "매칭 거절"
                  data: { matchId: "66d0...", isMatched: false, decided: "rejected" }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "403": { $ref: "./openapi.yaml#/components/responses/Forbidden" }
      "404": { $ref: "./openapi.yaml#/components/responses/NotFound" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/phone/request-code:
  post:
    tags: [Phone]
    summary: 인증 코드 요청(회원가입 보조)
    description: 입력한 휴대폰 번호로 6자리 인증 코드를 발송합니다.
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "./openapi.yaml#/components/schemas/PhoneRequest" }
          examples:
            default:
              value: { phone: "+821012345678" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        maskedPhone: { type: string, example: "+82***345678" }
                        expiresAt: { type: string, format: date-time }
                      required: [maskedPhone, expiresAt]
            examples:
              ok:
                value:
                  status: 200
                  message: "인증 코드 발송"
                  data: { maskedPhone: "+82***345678", expiresAt: "2025-09-12T22:10:00+09:00" }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "429":
        description: Too Many Requests
        content:
          application/json:
            schema: { $ref: "./openapi.yaml#/components/schemas/BaseResponse" }
            examples:
              tooMany:
                value: { status: 429, message: "요청이 너무 많습니다.", data: null, error: "rate_limit" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

/phone/verify:
  post:
    tags: [Phone]
    summary: 인증 코드 검증
    requestBody:
      required: true
      content:
        application/json:
          schema: { $ref: "./openapi.yaml#/components/schemas/PhoneVerifyRequest" }
          examples:
            default:
              value: { phone: "+821012345678", code: "123456" }
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              allOf:
                - $ref: "./openapi.yaml#/components/schemas/BaseResponse"
                - type: object
                  properties:
                    data: { $ref: "./openapi.yaml#/components/schemas/PhoneVerifyData" }
            examples:
              ok:
                value:
                  status: 200
                  message: "인증 완료"
                  data: { verified: true, expiresAt: null }
      "400": { $ref: "./openapi.yaml#/components/responses/BadRequest" }
      "401": { $ref: "./openapi.yaml#/components/responses/Unauthorized" }
      "500": { $ref: "./openapi.yaml#/components/responses/ServerError" }

