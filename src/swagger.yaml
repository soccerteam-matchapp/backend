openapi: 3.0.3
info:
  title: Soccer Matching App - Auth API
  version: 1.0.0
  description: |
    로그인/회원가입/토큰 재발급 API. 모든 응답은 { status:number, message:string, data:any|null, error?:string } 포맷을 사용합니다.
servers:
  - url: 'http://localhost:3000/api'
tags:
  - name: Auth
    description: 인증 관련 엔드포인트
paths:
  /auth/register:
    post:
      tags:
        - Auth
      summary: 회원가입
      description: |
        회원을 생성합니다. `username`을 보내도 내부에서 `name`으로 매핑되어 처리됩니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              default:
                value:
                  id: soccer123
                  name: 정혜원
                  password: secret12
              allowUsernameAlias:
                value:
                  id: soccer123
                  username: 정혜원
                  password: secret12
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
                        example: null
              examples:
                created:
                  value:
                    status: 201
                    message: 회원가입 성공
                    data: null
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/login:
    post:
      tags:
        - Auth
      summary: 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              default:
                value:
                  id: soccer123
                  password: secret12
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginData'
              examples:
                ok:
                  value:
                    status: 200
                    message: 로그인 성공
                    data:
                      accessToken: eyJhbGciOi...
                      refreshToken: eyJhbGciOi...
                      user:
                        id: 66c7e2d2f3a4f2bb1e8e1b11
                        name: 정혜원
                        role: member
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'
  /auth/refresh:
    post:
      tags:
        - Auth
      summary: 토큰 재발급
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
            examples:
              default:
                value:
                  refreshToken: eyJhbGciOi...
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TokensData'
              examples:
                ok:
                  value:
                    status: 200
                    message: 토큰 재발급 성공
                    data:
                      accessToken: new-access-token
                      refreshToken: new-refresh-token
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'
  /teams:
    post:
      tags:
        - Team
      summary: 팀 만들기(초대코드 발급)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                teamName:
                  type: string
              required:
                - teamName
            examples:
              default:
                value:
                  teamName: FC Tools
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                            description: 팀 _id
                          teamName:
                            type: string
                          inviteCode:
                            type: string
                            description: 6자리 초대코드
                          leader:
                            type: string
                            description: 팀장 _id
                          memberNum:
                            type: integer
                          canMatch:
                            type: boolean
                            description: 멤버 9명 이상이면 true
                        required:
                          - id
                          - teamName
                          - inviteCode
                          - leader
                          - memberNum
                          - canMatch
              examples:
                created:
                  value:
                    status: 201
                    message: 팀 생성 성공
                    data:
                      id: 66cc7a7f0c2e3a1234567890
                      teamName: FC Tools
                      inviteCode: '123456'
                      leader: 66c7e2d2f3a4f2bb1e8e1b11
                      memberNum: 1
                      canMatch: false
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/ServerError'
  '/teams/invite/{code}':
    get:
      tags:
        - Team
      summary: 초대코드로 팀 조회
      description: 초대코드로 팀 기본 정보를 조회합니다.
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: 발급된 6자리 초대코드
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: string
                          teamName:
                            type: string
                          inviteCode:
                            type: string
                          memberNum:
                            type: integer
                          canMatch:
                            type: boolean
                        required:
                          - id
                          - teamName
                          - inviteCode
                          - memberNum
                          - canMatch
              examples:
                ok:
                  value:
                    status: 200
                    message: 팀 조회 성공
                    data:
                      id: 66cc7a7f0c2e3a1234567890
                      teamName: FC Tools
                      inviteCode: '123456'
                      memberNum: 1
                      canMatch: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                notFound:
                  value:
                    status: 404
                    message: 해당 초대코드의 팀을 찾을 수 없습니다.
                    data: null
                    error: not_found
        '500':
          $ref: '#/components/responses/ServerError'
  /teams/join:
    post:
      tags:
        - Team
      summary: 초대코드로 가입 요청
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                inviteCode:
                  type: string
              required:
                - inviteCode
            examples:
              default:
                value:
                  inviteCode: '123456'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          teamId:
                            type: string
                          pendingCount:
                            type: integer
                        required:
                          - teamId
                          - pendingCount
              examples:
                ok:
                  value:
                    status: 200
                    message: 가입 요청 접수
                    data:
                      teamId: 66cc7a7f0c2e3a1234567890
                      pendingCount: 1
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                notFound:
                  value:
                    status: 404
                    message: 해당 초대코드의 팀을 찾을 수 없습니다.
                    data: null
                    error: not_found
        '500':
          $ref: '#/components/responses/ServerError'
  '/teams/{teamId}/requests':
    get:
      tags:
        - Team
      summary: 가입 대기 목록(팀장 전용)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: teamId
          required: true
          schema:
            type: string
            description: 팀 _id(ObjectId)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                            id:
                              type: string
                              description: 로그인 아이디(username)
                          required:
                            - _id
                            - name
                            - id
              examples:
                ok:
                  value:
                    status: 200
                    message: 가입 대기 목록
                    data:
                      - _id: 66c7e2d2f3a4f2bb1e8e1b11
                        name: 김철수
                        id: cs123
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                forbidden:
                  value:
                    status: 403
                    message: 팀장만 확인할 수 있습니다.
                    data: null
                    error: forbidden
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                notFound:
                  value:
                    status: 404
                    message: 팀을 찾을 수 없습니다.
                    data: null
                    error: not_found
        '500':
          $ref: '#/components/responses/ServerError'
  '/teams/{teamId}/requests/decide':
    post:
      tags:
        - Team
      summary: 가입 요청 일괄 수락/거절(팀장 전용)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: teamId
          required: true
          schema:
            type: string
            description: 팀 _id(ObjectId)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                accept:
                  type: array
                  items:
                    type: string
                    description: 수락할 사용자 _id
                reject:
                  type: array
                  items:
                    type: string
                    description: 거절할 사용자 _id
              required:
                - accept
                - reject
            examples:
              acceptSome:
                value:
                  accept:
                    - 66c7e2d2f3a4f2bb1e8e1b11
                  reject: []
              rejectSome:
                value:
                  accept: []
                  reject:
                    - 66c7e2d2f3a4f2bb1e8e1b22
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          teamId:
                            type: string
                          memberNum:
                            type: integer
                          canMatch:
                            type: boolean
                          accepted:
                            type: integer
                          rejected:
                            type: integer
                          remainingPending:
                            type: integer
                        required:
                          - teamId
                          - memberNum
                          - canMatch
                          - accepted
                          - rejected
                          - remainingPending
              examples:
                ok:
                  value:
                    status: 200
                    message: 처리 완료
                    data:
                      teamId: 66cc7a7f0c2e3a1234567890
                      memberNum: 9
                      canMatch: true
                      accepted: 1
                      rejected: 0
                      remainingPending: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                forbidden:
                  value:
                    status: 403
                    message: 팀장만 처리할 수 있습니다.
                    data: null
                    error: forbidden
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
              examples:
                notFound:
                  value:
                    status: 404
                    message: 팀을 찾을 수 없습니다.
                    data: null
                    error: not_found
        '500':
          $ref: '#/components/responses/ServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        액세스 토큰을 Bearer 스킴으로 전송합니다. 예) "Authorization: Bearer <token>"
  schemas:
    BaseResponse:
      type: object
      properties:
        status:
          type: integer
          format: int32
          example: 200
        message:
          type: string
          example: OK
        data:
          nullable: true
        error:
          type: string
          nullable: true
          description: 에러 코드(있는 경우)
      required:
        - status
        - message
    Role:
      type: string
      enum:
        - leader
        - member
    RegisterRequest:
      type: object
      properties:
        id:
          type: string
          description: 로그인 아이디(중복 불가)
          minLength: 3
        name:
          type: string
          description: 사용자 이름 (별칭 `username`도 허용되며 내부에서 name으로 매핑됨)
        password:
          type: string
          minLength: 6
      required:
        - id
        - name
        - password
    LoginRequest:
      type: object
      properties:
        id:
          type: string
        password:
          type: string
      required:
        - id
        - password
    RefreshRequest:
      type: object
      properties:
        refreshToken:
          type: string
      required:
        - refreshToken
    UserSummary:
      type: object
      properties:
        id:
          type: string
          description: MongoDB _id 문자열
        name:
          type: string
        role:
          $ref: '#/components/schemas/Role'
      required:
        - id
        - name
        - role
    TokensData:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
      required:
        - accessToken
        - refreshToken
    LoginData:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/UserSummary'
      required:
        - accessToken
        - refreshToken
        - user
  responses:
    BadRequest:
      description: 잘못된 요청(ValidationError 등)
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  status:
                    type: integer
                    example: 400
                  data:
                    nullable: true
                    example: null
                  error:
                    type: string
                    example: validation_error
          examples:
            missingFields:
              value:
                status: 400
                message: 'id, name, password가 모두 필요합니다.'
                data: null
                error: validation_error
    Unauthorized:
      description: '인증 실패(토큰 만료/무효, 잘못된 자격증명 등)'
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  data:
                    nullable: true
                    example: null
                  error:
                    type: string
                    example: invalid_credentials
          examples:
            invalidCredentials:
              value:
                status: 401
                message: Invalid credentials.
                data: null
                error: invalid_credentials
            tokenExpired:
              value:
                status: 401
                message: token expired
                data: null
                error: token_expired
            tokenInvalid:
              value:
                status: 401
                message: invalid token
                data: null
                error: token_invalid
    Conflict:
      description: 자원 충돌(중복 아이디 등)
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  status:
                    type: integer
                    example: 409
                  data:
                    nullable: true
                    example: null
                  error:
                    type: string
                    example: duplicate_key
          examples:
            duplicateId:
              value:
                status: 409
                message: 이미 존재하는 아이디입니다.
                data: null
                error: duplicate_key
    ServerError:
      description: 서버 오류
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/BaseResponse'
              - type: object
                properties:
                  status:
                    type: integer
                    example: 500
                  data:
                    nullable: true
                    example: null
                  error:
                    type: string
                    example: server_error
          examples:
            default:
              value:
                status: 500
                message: 서버 오류가 발생했습니다.
                data: null
                error: server_error
